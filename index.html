<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PUSH | Thinking Tree</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #ffffff; 
            --accent: #ff3e00; 
            --bg: #0a0a0a; 
            --line: #2a2a2a; 
            --text-dim: rgba(255,255,255,0.6);
        }
        
        body { margin: 0; background: var(--bg); font-family: 'Inter', sans-serif; overflow: hidden; color: var(--primary); }
        
        #header { position: absolute; top: 40px; left: 40px; border-left: 5px solid var(--accent); padding-left: 20px; pointer-events: none; z-index: 10; }
        h1 { margin: 0; font-size: 32px; font-weight: 800; letter-spacing: -1.5px; line-height: 1; }
        p { margin: 8px 0 0; font-size: 11px; font-weight: 600; color: #777; text-transform: uppercase; letter-spacing: 2px; }

        #top-controls { position: absolute; top: 40px; right: 40px; z-index: 20; display: flex; flex-direction: column; gap: 10px; align-items: flex-end; }
        
        #search-container { 
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); 
            z-index: 20; display: flex; flex-direction: column; gap: 8px;
            align-items: center; width: auto; 
        }
        
        #dept-controls { 
            display: flex; gap: 6px;
            justify-content: center; white-space: nowrap;
        }

        #search-error { color: var(--accent); font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; }
        .search-row { display: flex; gap: 10px; align-items: center; }

        .glass-btn {
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 50px;
            padding: 8px 16px;
            color: white; font-size: 9px; font-weight: 600;
            text-transform: uppercase; letter-spacing: 1px; cursor: pointer;
            transition: all 0.3s ease; box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            text-align: center;
        }
        .glass-btn:hover { background: var(--accent); border-color: var(--accent); }

        #search-input {
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 50px;
            padding: 10px 25px; width: 300px; color: white; font-size: 14px; outline: none;
            transition: all 0.3s ease;
        }
        #search-input:focus { width: 400px; border-color: var(--accent); }

        .node-rect { stroke: rgba(255,255,255,0.1); stroke-width: 1px; rx: 12; ry: 12; cursor: pointer; transition: fill 0.3s ease; }
        
        .node-dept, .node-name, .node-title, .toggle-icon-group, .root-expand-text { pointer-events: none; }

        .node-dept { font-size: 9px; font-weight: 800; fill: rgba(255,255,255,0.9); }
        .node-name { font-size: 11px; font-weight: 800; text-transform: uppercase; fill: #fff; }
        .node-title { font-size: 9px; font-weight: 400; fill: var(--text-dim); }
        .toggle-bg { fill: rgba(255,255,255,0.2); }
        .toggle-text { fill: #fff; font-size: 14px; font-weight: 800; text-anchor: middle; }
        .root-expand-text { font-size: 8px; font-weight: 600; fill: var(--text-dim); text-anchor: middle; text-transform: uppercase; }

        .link { stroke: var(--line); stroke-width: 2px; fill: none; }
        svg { cursor: move; }
    </style>
</head>
<body>

<div id="header">
    <h1>PUSH</h1>
    <p>Organizational Thinking Tree</p>
</div>

<div id="top-controls">
    <button id="toggle-all" class="glass-btn" style="width:140px; font-size:11px; padding: 12px 25px;">Expand All</button>
    <button id="organize-btn" class="glass-btn" style="width:140px; font-size:11px; padding: 12px 25px;">Organize</button>
</div>

<div id="search-container">
    <div id="dept-controls"></div>
    <div id="search-error">Please expand all before searching</div>
    <div class="search-row">
        <input type="text" id="search-input" placeholder="Search talent..." autocomplete="off">
        <button id="search-button" class="glass-btn" style="width: auto; font-size: 12px; padding: 10px 20px;">Search</button>
    </div>
</div>

<script>
    const width = window.innerWidth, height = window.innerHeight;

    const verticalThemes = {
        "PUSH": { color: "#4a148c", dept: "HQ", angle: 0 },
        "Chelsea Soochit": { color: "#4527a0", dept: "PEOPLE & CULTURE", angle: 135 },
        "Gino Cantalini": { color: "#d32f2f", dept: "BRAND", angle: 0 },
        "Julie Allen": { color: "#ef6c00", dept: "FINANCE", angle: 45 },
        "Braden Bailey": { color: "#00695c", dept: "OPERATIONS", angle: 90 },
        "Jason Prance": { color: "#283593", dept: "STRATEGY", angle: 180 },
        "Kirsten Moore": { color: "#c2185b", dept: "CLIENT SERVICES", angle: 225 },
        "Darren Hardeman": { color: "#1565c0", dept: "MEDIA CA", angle: 270 },
        "Andres Torrente": { color: "#2e7d32", dept: "MEDIA U.S.", angle: 315 }
    };

    const fullData = {
        name: "PUSH", 
        isRoot: true,
        children: [
            { name: "Gino Cantalini", title: "Chief Brand Officer" },
            { name: "Chelsea Soochit", title: "People & Culture" },
            { 
                name: "Julie Allen", title: "Chief Financial Officer, NA", 
                children: [
                    { 
                        name: "Jack Vukanovich", title: "Controller",
                        children: [
                            { name: "Serena Martini", title: "Staff Accountant" },
                            { name: "Mabel Thompson", title: "Accounting Manager" }
                        ]
                    }
                ] 
            },
            { 
                name: "Braden Bailey", title: "Chief Operating Officer", 
                children: [
                    { name: "Nataliya Polyakova", title: "Creative Technologist" },
                    { name: "Ashley Walton", title: "Lead, Creative Technologist" },
                    { name: "Evgeniy Polyakova", title: "Creative Technologist" },
                    { 
                        name: "Lauren Harvey", title: "Head of Operations & Resourcing",
                        children: [
                            { name: "Stephan Guenette", title: "Lead, Creative Production & Resourcing" },
                            { name: "Emma Bakos", title: "Sr. Specialist, Project Operations" }
                        ]
                    }
                ] 
            },
            { 
                name: "Jason Prance", title: "Chief Strategy & Innovation Officer",
                children: [
                    { name: "Sean Macphedran", title: "Sr. Lead, Business Innovation & AI" },
                    { name: "Owen Melhuish", title: "Lead, Business Innovation & AI" },
                    { name: "Suzy An", title: "Lead, Creative & Design Architect" },
                    { name: "Schuyler Vanderveen", title: "Lead, Creative & Experience Architect" },
                    { 
                        name: "Jeremy Agers", title: "Head of Content & Creative Strategy",
                        children: [
                            { name: "Anna Clauson", title: "Manager, Creator & Influencer Strategy" }
                        ]
                    }
                ]
            },
            { 
                name: "Kirsten Moore", title: "Managing Director, Client Partnerships NA",
                children: [
                    { name: "Mark Christie", title: "Sr. Lead, Client Partnerships" },
                    { 
                        name: "Tommy Campagne", title: "Managing Director, Client Partnerships U.S.",
                        children: [
                            { name: "Janet Kirkman", title: "Sr. Lead, Client Partnerships" }
                        ]
                    }
                ]
            },
            { 
                name: "Andres Torrente", title: "Managing Director, Media U.S.",
                children: [
                    { name: "Sam Shah", title: "Data Specialist" },
                    { 
                        name: "Andrew Freichlag", title: "Sr. Lead, Media Decisioning",
                        children: [
                            { name: "Nahla Elshatanofy", title: "Manager, Media Decisioning" }
                        ]
                    },
                    { 
                        name: "Jessica Teylan", title: "Lead, Media Decisioning",
                        children: [
                            { name: "Julianna Sarkissian", title: "Manager, Media Decisioning" }
                        ]
                    }
                ]
            },
            { 
                name: "Darren Hardeman", title: "Managing Director, Media CA",
                children: [
                    { 
                        name: "Matt Edgar", title: "Sr. Lead Media Decisioning",
                        children: [
                            { name: "Jonathan Lim", title: "Manager, Media Decisioning" },
                            { name: "Estheymi Gonzales", title: "Specialist, Media Orchestration" },
                            { name: "Abhinandan Dixit", title: "Sr.Specialist, Media Orchestration" },
                            { name: "Keshav Krishan", title: "Manager, Media Decisioning" },
                            { name: "Davensh Malviya", title: "Sr. Specialist, Media Orchestration" },
                            { name: "Ayaz Khan", title: "Data Analyst" }
                        ]
                    }
                ]
            }
        ]
    };

    const zoom = d3.zoom().scaleExtent([0.1, 3]).on("zoom", (e) => container.attr("transform", e.transform));
    const svg = d3.select("body").append("svg").attr("width", width).attr("height", height).call(zoom).append("g");
    const container = svg, linkGroup = svg.append("g"), nodeGroup = svg.append("g");

    const simulation = d3.forceSimulation()
        .force("link", d3.forceLink().id(d => d.id).distance(d => d.source.depth === 0 ? 250 : 150))
        .force("charge", d3.forceManyBody().strength(-350))
        .force("center", d3.forceCenter(width / 2, height / 2))
        .force("collision", d3.forceCollide().radius(d => d.data.isRoot ? 260 : 120))
        .alphaDecay(0.12);

    let nodes = [], links = [], isAllExpanded = false;
    const rootHierarchy = d3.hierarchy(fullData);
    
    rootHierarchy.descendants().forEach((d, i) => {
        d.id = i; d._children = d.children; d.children = null;
        let ancestor = d;
        while (ancestor.depth > 1) ancestor = ancestor.parent;
        const theme = verticalThemes[ancestor.data.name] || verticalThemes["PUSH"];
        d.color = theme.color; d.dept = theme.dept; d.targetAngle = theme.angle;
    });

    nodes = [rootHierarchy];
    rootHierarchy.x = width / 2; rootHierarchy.y = height / 2;
    update();

    function wrap(text, width) {
        text.each(function() {
            var text = d3.select(this),
                words = text.text().split(/\s+/).reverse(),
                word,
                line = [],
                lineNumber = 0,
                lineHeight = 1.1,
                y = text.attr("y"),
                dy = parseFloat(text.attr("dy") || 0),
                tspan = text.text(null).append("tspan").attr("x", text.attr("x")).attr("y", y).attr("dy", dy + "em");
            while (word = words.pop()) {
                line.push(word);
                tspan.text(line.join(" "));
                if (tspan.node().getComputedTextLength() > width) {
                    line.pop();
                    tspan.text(line.join(" "));
                    line = [word];
                    tspan = text.append("tspan").attr("x", text.attr("x")).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
                }
            }
            this.lineCount = lineNumber + 1;
        });
    }

    function update() {
        const link = linkGroup.selectAll(".link").data(links, d => d.target.id);
        link.exit().remove();
        const mergedLinks = link.enter().append("line").attr("class", "link").merge(link);

        const node = nodeGroup.selectAll(".node").data(nodes, d => d.id);
        node.exit().remove();
        const nodeEnter = node.enter().append("g").attr("class", "node")
            .on("click", (e, d) => { 
                e.stopPropagation();
                if (!e.defaultPrevented) toggleNode(d); 
            })
            .call(d3.drag().on("start", dragstarted).on("drag", dragged).on("end", dragended));

        // 3-Column Root Hub
        const rootNodes = nodeEnter.filter(d => d.data.isRoot);
        const rwRoot = 450, rhRoot = 100;
        
        rootNodes.append("rect").attr("class", "node-rect").attr("width", rwRoot).attr("height", rhRoot).attr("x", -rwRoot/2).attr("y", -rhRoot/2).style("fill", d => d.color);
        rootNodes.append("text").attr("class", "node-dept").attr("x", 0).attr("y", -30).attr("text-anchor", "middle").text("PUSH");
        rootNodes.append("text").attr("class", "node-name").attr("x", -rwRoot/2 + 20).attr("y", 0).text("KYLE VERGE");
        rootNodes.append("text").attr("class", "node-title").attr("x", -rwRoot/2 + 20).attr("y", 12).text("CEO");
        
        rootNodes.append("text").attr("class", "root-expand-text").attr("x", 0).attr("y", 25).text("Click to toggle");
        const toggleGroupRoot = rootNodes.append("g").attr("class", "toggle-icon-group");
        toggleGroupRoot.append("circle").attr("class", "toggle-bg").attr("r", 12).attr("cx", 0).attr("cy", 0);
        toggleGroupRoot.append("text").attr("class", "toggle-text").attr("x", 0).attr("y", 5);
        
        rootNodes.append("text").attr("class", "node-name").attr("x", rwRoot/2 - 20).attr("y", 0).attr("text-anchor", "end").text("JULIE BERGER");
        rootNodes.append("text").attr("class", "node-title").attr("x", rwRoot/2 - 20).attr("y", 12).attr("text-anchor", "end").text("President, NA");

        // Talent Nodes
        const standardNodes = nodeEnter.filter(d => !d.data.isRoot);
        const rw = 195;
        standardNodes.append("rect").attr("class", "node-rect").attr("width", rw).attr("x", -rw/2).style("fill", d => d.color);
        standardNodes.append("text").attr("class", "node-dept").attr("x", -rw/2 + 15).attr("y", -14).text(d => d.dept);
        standardNodes.append("text").attr("class", "node-name").attr("x", -rw/2 + 15).attr("y", 4).text(d => d.data.name);
        const titleText = standardNodes.append("text").attr("class", "node-title").attr("x", -rw/2 + 15).attr("y", 18).text(d => d.data.title);
        titleText.call(wrap, rw - 30);

        standardNodes.each(function(d) {
            const t = d3.select(this).select(".node-title").node();
            const lines = t.lineCount || 1;
            const rh = 70 + (lines * 8);
            d3.select(this).select(".node-rect").attr("height", rh).attr("y", -rh/2);
            
            const tg = d3.select(this).append("g").attr("class", "toggle-icon-group");
            tg.append("circle").attr("class", "toggle-bg").attr("r", 10).attr("cx", rw/2 - 20).attr("cy", rh/2 - 20);
            tg.append("text").attr("class", "toggle-text").attr("x", rw/2 - 20).attr("y", rh/2 - 16);
        });

        const mergedNodes = nodeEnter.merge(node);
        
        // Update Icons based on state
        mergedNodes.selectAll(".toggle-icon-group").style("display", d => (d._children || d.children) ? "block" : "none");
        mergedNodes.selectAll(".toggle-text").text(d => d.children ? "âˆ’" : "+");

        simulation.nodes(nodes);
        simulation.force("link").links(links);
        simulation.alpha(0.3).restart();

        simulation.on("tick", () => {
            mergedLinks.attr("x1", d => d.source.x).attr("y1", d => d.source.y).attr("x2", d => d.target.x).attr("y2", d => d.target.y);
            mergedNodes.attr("transform", d => `translate(${d.x},${d.y})`);
        });
    }

    function toggleNode(d) {
        if (d.children) {
            const walk = (n) => { if (n.children) { n.children.forEach(c => { nodes = nodes.filter(x => x.id !== c.id); links = links.filter(l => l.target.id !== c.id); walk(c); }); } };
            walk(d); d._children = d.children; d.children = null;
        } else if (d._children) {
            d.children = d._children; d._children = null;
            d.children.forEach(c => { if (!nodes.find(n => n.id === c.id)) { c.x = d.x; c.y = d.y; nodes.push(c); links.push({source: d, target: c}); } });
        }
        update();
    }

    const uniqueDepts = [...new Set(Object.values(verticalThemes).map(t => t.dept))].filter(d => d !== "HQ");
    const deptBox = document.getElementById('dept-controls');
    uniqueDepts.forEach(dept => {
        const btn = document.createElement('button');
        btn.className = 'glass-btn';
        btn.innerText = dept;
        btn.onclick = (e) => { e.stopPropagation(); expandDept(dept); };
        deptBox.appendChild(btn);
    });

    function expandDept(deptName) {
        if (rootHierarchy._children) toggleNode(rootHierarchy);
        const bloom = (n) => {
            if (n._children) toggleNode(n);
            if (n.children) n.children.forEach(bloom);
        };
        const lead = rootHierarchy.children.find(c => {
            const theme = verticalThemes[c.data.name];
            return theme && theme.dept === deptName;
        });
        if (lead) {
            const activeLead = nodes.find(n => n.id === lead.id);
            bloom(activeLead || lead);
            setTimeout(() => {
                const target = nodes.find(n => n.id === lead.id);
                const t = d3.zoomIdentity.translate(width/2, height/2).scale(1).translate(-target.x, -target.y);
                d3.select("svg").transition().duration(1000).call(zoom.transform, t);
            }, 500);
        }
    }

    document.getElementById('toggle-all').addEventListener('click', () => {
        if (!isAllExpanded) {
            const expandAll = (n) => { if (n._children) toggleNode(n); if (n.children) n.children.forEach(expandAll); };
            expandAll(rootHierarchy);
            document.getElementById('toggle-all').innerText = "Collapse All"; isAllExpanded = true;
            setTimeout(() => fitToScreen(), 800);
        } else {
            const walk = (n) => { if (n.children) { n.children.forEach(walk); toggleNode(n); } };
            walk(rootHierarchy);
            document.getElementById('toggle-all').innerText = "Expand All"; isAllExpanded = false;
        }
    });

    document.getElementById('organize-btn').addEventListener('click', () => {
        nodes.forEach(d => {
            if (d.depth > 0) {
                const angle = (d.targetAngle * Math.PI) / 180;
                const distance = 350 + (d.depth * 100);
                d.x = width / 2 + Math.cos(angle) * distance;
                d.y = height / 2 + Math.sin(angle) * distance;
            }
        });
        simulation.alpha(0.5).restart();
        setTimeout(() => fitToScreen(), 500);
    });

    function fitToScreen() {
        const bounds = container.node().getBBox();
        const midX = bounds.x + bounds.width / 2, midY = bounds.y + bounds.height / 2;
        const scale = 0.8 / Math.max(bounds.width / width, bounds.height / height);
        d3.select("svg").transition().duration(1200).call(zoom.transform, d3.zoomIdentity.translate(width/2, height/2).scale(scale).translate(-midX, -midY));
    }

    function performSearch() {
        const errorMsg = document.getElementById('search-error');
        errorMsg.style.opacity = "0";
        const term = document.getElementById('search-input').value.toLowerCase().trim();
        if (!term) return;
        const target = rootHierarchy.descendants().find(d => d.data.name.toLowerCase().includes(term));
        const activeTarget = nodes.find(n => n.id === (target ? target.id : -1));
        if (target && activeTarget) {
            setTimeout(() => {
                const t = d3.zoomIdentity.translate(width/2, height/2).scale(1.2).translate(-activeTarget.x, -activeTarget.y);
                d3.select("svg").transition().duration(1000).call(zoom.transform, t);
            }, 100);
        } else {
            errorMsg.style.opacity = "1";
            setTimeout(() => { errorMsg.style.opacity = "0"; }, 4000);
        }
    }

    document.getElementById('search-input').addEventListener('keypress', (e) => { if (e.key === 'Enter') performSearch(); });
    document.getElementById('search-button').addEventListener('click', performSearch);
    function dragstarted(event, d) { if (!event.active) simulation.alphaTarget(0.1).restart(); d.fx = d.x; d.fy = d.y; }
    function dragged(event, d) { d.fx = event.x; d.fy = event.y; }
    function dragended(event, d) { if (!event.active) simulation.alphaTarget(0); d.fx = null; d.fy = null; }
</script>
</body>
</html>
